<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="username">Nams</title>
</head>
<body>
    <h1>Profile</h1>
    <h2>Welcome back <span id="user-greeting"></span></h2>
    <a href="Home">Home</a>
    <div class="profile">
        <div class="title">
            <div class="header">
                <div class="links">
                    <a href="#" id="logoutLink">Logout</a>
                </div>
            </div>
        </div>
        <div class="body">
            <div class="username"></div>
            <div class="name">
                <div class="first-name"></div>
                <div class="last-name"></div>
            </div>
            <div class="email" id="user-email"></div>
            <div class="phone" id="user-phone"></div>
        </div>
    </div>

    <script>
        
        const userCookie = document.cookie.split('; ').find(cookie => cookie.startsWith('user_id='));
        const userId = userCookie ? userCookie.split('=')[1] : null;

        async function fetchData() {
            try {
                const response = await fetch(`api/users/${userId}/profile`);
                const data = await response.json();

                const titleElement = document.getElementById('username');
                titleElement.textContent = data.username; 

                const greetingElement = document.getElementById('user-greeting');
                greetingElement.textContent = data.username;

                const emailElement = document.getElementById('user-email');
                emailElement.textContent = 'email: ' + data.email; 

                const phoneElement = document.getElementById('user-phone');
                phoneElement.textContent = 'phone: ' + data.phone_number; 
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function logoutUser() {
            document.getElementById('logoutLink').addEventListener('click', async (event) => {
                event.preventDefault();
                try {
                    const response = await fetch('api/users/logout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        window.location.href = '/';
                    } else {
                        console.error('Please try again');
                    }
                } catch (error) {
                    console.error('Fetch error:', error);
                }
                
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            logoutUser();
        });
        
    </script>
</body>
</html>
